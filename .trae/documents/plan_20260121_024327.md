# 项目框架优化方案：分离节点逻辑与界面修改

## 当前架构问题
- **耦合度高**：节点的属性、功能创建与界面修改混合在一起
- **职责不清**：数据操作和界面渲染逻辑交织
- **维护困难**：修改节点逻辑时可能影响界面，反之亦然
- **扩展性差**：难以独立扩展节点功能或界面特性

## 优化架构方案

### 1. 分层架构设计
- **数据层**：节点的属性定义和数据模型
- **业务逻辑层**：节点的创建、修改、删除等核心操作
- **界面层**：组件渲染和用户交互

### 2. 具体实现方案

#### 数据层优化
- **创建独立的模型文件**：`src/models/node.ts`，定义节点的属性和类型
- **分离节点模板**：将 `nodeTemplates` 从 `editorStore.ts` 移到 `src/models/nodeTemplates.ts`
- **统一数据结构**：确保所有节点相关的数据结构都在数据层定义

#### 业务逻辑层优化
- **重构 editorStore**：将其拆分为多个专门的 store
  - `src/store/nodeStore.ts`：处理节点的创建、修改、删除
  - `src/store/connectionStore.ts`：处理连接的管理
  - `src/store/canvasStore.ts`：处理画布的操作
  - `src/store/editorStore.ts`：作为主 store，整合其他 store
- **业务逻辑抽象**：将节点的核心功能（如连接创建、属性验证等）抽象为独立的服务
  - `src/services/nodeService.ts`：提供节点相关的业务逻辑
  - `src/services/connectionService.ts`：提供连接相关的业务逻辑

#### 界面层优化
- **组件职责分离**：
  - 纯展示组件：只负责渲染数据
  - 容器组件：负责状态管理和业务逻辑
- **事件处理优化**：
  - 在界面层处理用户交互事件
  - 通过 store 或 service 调用业务逻辑
  - 避免直接在组件中修改数据

### 3. 编辑操作冲突解决方案
- **在业务逻辑层处理**：在 `nodeStore.ts` 中添加编辑状态管理
- **界面层隔离**：在文本编辑组件中阻止事件冒泡
- **统一的事件处理机制**：所有键盘事件通过统一的处理机制分发

### 4. 实现步骤

#### 第一步：数据层重构
1. 创建 `src/models/node.ts`，定义节点数据结构
2. 创建 `src/models/nodeTemplates.ts`，管理节点模板
3. 更新 `src/types/index.ts`，确保类型定义清晰

#### 第二步：业务逻辑层重构
1. 创建 `src/store/nodeStore.ts`，处理节点相关操作
2. 创建 `src/store/connectionStore.ts`，处理连接相关操作
3. 创建 `src/store/canvasStore.ts`，处理画布相关操作
4. 重构 `src/store/editorStore.ts`，整合其他 store
5. 创建 `src/services/` 目录，添加业务逻辑服务

#### 第三步：界面层优化
1. 重构组件，分离展示和容器组件
2. 优化事件处理，确保编辑操作不冲突
3. 实现编辑状态的视觉反馈

#### 第四步：测试和优化
1. 测试所有功能的交互和冲突
2. 优化性能和用户体验
3. 确保架构的可扩展性

## 预期效果
- **职责清晰**：节点的属性和功能创建与界面修改分开处理
- **可维护性高**：修改节点逻辑不会影响界面，反之亦然
- **扩展性强**：可以独立扩展节点功能或界面特性
- **操作流畅**：解决编辑操作冲突，提供专业的编辑体验
- **易于测试**：分层架构便于单元测试和集成测试